<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”¼ì ì±„ìš°ê¸° íƒêµ¬ (ì—…ë°ì´íŠ¸)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        #scene-container {
            background-color: #1a202c;
            border-radius: 0.5rem;
            cursor: grab;
        }
        #scene-container:active {
            cursor: grabbing;
        }
        .btn {
            @apply bg-teal-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-75 transition-all duration-200 w-full;
        }
        .btn:disabled {
            @apply opacity-50 cursor-not-allowed;
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 focus:ring-gray-500;
        }
        /* ì…ë ¥ê°’ì„ 'ê²€ì •ìƒ‰'ìœ¼ë¡œ ë³´ì´ë„ë¡ ê°•ì œ */
        input[type="number"] {
            @apply w-32 px-4 py-2 text-xl text-center border-2 border-gray-600 rounded-lg font-bold;
            color: #000 !important;
            background-color: #ffffff !important;
        }
        input[type="text"] {
            @apply w-40 px-4 py-2 text-lg text-center border-2 border-gray-600 rounded-lg font-bold;
            color: #000 !important;
            background-color: #ffffff !important;
        }
        .kbd {
            @apply inline-block px-2 py-1 rounded bg-gray-700 text-gray-100 text-sm;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-300">ğŸ• Sì‚¬ì´ì¦ˆ í”¼ìë¡œ Lì‚¬ì´ì¦ˆë¥¼ ì±„ìš¸ ìˆ˜ ìˆì„ê¹Œ?</h1>
            <p class="text-lg text-gray-400 mt-2">ë¨¼ì € ì§ì ‘ ì±„ì›Œë³´ê³  â†’ ê·¸ë‹¤ìŒ ì›ë¦¬ë¡œ ì¶”ë¡ í•˜ê³  â†’ ë§ˆì§€ë§‰ì— ìƒê°ì„ ì •ë¦¬í•´ìš”.</p>
        </header>

        <div class="flex flex-col lg:flex-row gap-6">
            <div class="flex-grow">
                <div id="scene-container" class="w-full h-96 lg:h-[500px]"></div>
                <p class="text-center text-xs text-gray-500 mt-2">ë§ˆìš°ìŠ¤ë¡œ ë“œë˜ê·¸í•´ íšŒì „í•˜ê³ , ìŠ¤í¬ë¡¤ë¡œ í™•ëŒ€/ì¶•ì†Œí•´ ë³´ì„¸ìš”.</p>
            </div>

            <div class="w-full lg:w-96 bg-gray-800 p-6 rounded-lg shadow-xl flex-shrink-0 flex flex-col justify-center min-h-[300px]">
                <div id="step-0" class="space-y-4 text-center">
                    <p class="text-lg">ë‘ ê°€ì§€ í¬ê¸°ì˜ í”¼ìê°€ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="bg-gray-700 p-4 rounded-lg space-y-2">
                        <div class="text-pink-300 font-bold">S ì‚¬ì´ì¦ˆ</div>
                        <div class="text-gray-300 text-sm">ì§€ë¦„ 20cm, ë†’ì´ 2cm</div>
                        <div class="text-yellow-300 font-bold mt-3">L ì‚¬ì´ì¦ˆ</div>
                        <div class="text-gray-300 text-sm">ì§€ë¦„ 30cm, ë†’ì´ <span class="font-bold text-white">?cm</span></div>
                    </div>
                    <p class="text-gray-400 mt-2">ë‘ í”¼ìëŠ” ë‹®ì€ ì›ê¸°ë‘¥ì…ë‹ˆë‹¤. Lí”¼ì ìƒìë¥¼ Sí”¼ìë¡œ ì±„ì›Œ ë³¼ê¹Œìš”?</p>
                    <button id="next-btn-0" class="btn mt-2">ë¨¼ì € ì§ì ‘ ì±„ì›Œë³´ê¸°</button>
                </div>

                <div id="step-1" class="hidden space-y-4">
                    <p class="text-lg text-center">S í”¼ìë¥¼ ì¡°ê°ë‚´ì„œ L ìƒìì— ì±„ì›Œë³´ì„¸ìš”!</p>
                    <div class="flex items-center justify-center gap-3 mt-2">
                        <label class="text-gray-300 whitespace-nowrap">Sí”¼ì ê°œìˆ˜:</label>
                        <input type="number" id="pizzaCountInput" min="0" max="10" step="0.1" value="0" aria-label="Sí”¼ì ê°œìˆ˜ ì…ë ¥">
                    </div>
                    <div id="status" class="text-center p-4 bg-gray-700 rounded-lg mt-2 text-gray-300">
                        ìˆ«ìë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”!
                    </div>
                    <button id="hint-btn-1" class="btn btn-secondary mt-2">íŒíŠ¸</button>
                    <div id="hint-text-1" class="hidden text-teal-300 text-center pt-1 pb-1">
                        <p class="text-sm"><span class="kbd">3</span>ê³¼ <span class="kbd">4</span> ì‚¬ì´ ì–´ë”˜ê°€ì˜ˆìš”!</p>
                    </div>
                    <div class="flex justify-between mt-2 gap-2">
                        <button id="prev-btn-1" class="btn btn-secondary">ì´ì „</button>
                        <button id="next-btn-1" class="btn">ê³„ì‚°ìœ¼ë¡œ í™•ì¸í•˜ê¸°</button>
                        <button id="jump-to-answer-btn" class="btn hidden">ì •í™•íˆ ëª‡ íŒì¼ê¹Œ?</button>
                    </div>
                </div>

                <div id="step-2" class="hidden space-y-4 text-center">
                    <p class="text-lg">ë¶€í”¼ë¡œ ìƒê°í•´ë³¼ê¹Œìš”?</p>
                    <div class="bg-gray-700 p-4 rounded-lg space-y-2 text-left">
                        <div><span class="text-pink-300">S ë¶€í”¼:</span> <span class="text-gray-300">Ï€ Ã— 10Â² Ã— 2 = <b>200Ï€</b> cmÂ³</span></div>
                        <div><span class="text-yellow-300">L ë¶€í”¼:</span> <span class="text-gray-300">Ï€ Ã— 15Â² Ã— <b>h</b> = <b>225Ï€h</b> cmÂ³</span></div>
                        <hr class="border-gray-600 my-2">
                        <div class="text-gray-200">í•„ìš”í•œ Sí”¼ì ê°œìˆ˜ N = L/S = (225Ï€h)/(200Ï€) = <b>9h/8</b></div>
                    </div>
                    <button id="hint-btn-2" class="btn btn-secondary mt-2">íŒíŠ¸</button>
                    <div id="hint-text-2" class="hidden text-teal-300 pt-2 pb-2">
                        <p class="font-bold">ì‹¤í—˜(1ë‹¨ê³„)ì—ì„œ ì±„ì›Œ ë³´ë©° ì¶”ì •í•œ N ê°’ì„ ì‹ N=9h/8ì— ëŒ€ì…í•´ ë³´ì„¸ìš”.</p>
                        <p class="text-sm text-gray-200">ì˜ˆ: Nâ‰ˆ3.4ë¼ë©´ 3.4â‰ˆ9h/8 â†’ hâ‰ˆ(8Ã—3.4)/9</p>
                    </div>
                    <div class="flex justify-between mt-2 gap-2">
                        <button id="prev-btn-2" class="btn btn-secondary">ì´ì „</button>
                        <button id="next-btn-2" class="btn">ì •ë‹µ ê°œìˆ˜ ì…ë ¥í•˜ê¸°</button>
                    </div>
                </div>

                <div id="step-3" class="hidden space-y-4 text-center">
                    <p class="text-lg">ì •í™•í•œ Sí”¼ì <b>ê°œìˆ˜</b>ë¥¼ ì…ë ¥í•´ ë³´ì„¸ìš”.</p>
                    <div class="flex items-center justify-center gap-3">
                        <label class="text-gray-300">ì •ë‹µ ì‹œë„:</label>
                        <input type="text" id="answerInput" inputmode="decimal" placeholder="ì˜ˆ: 3.625?">
                    </div>
                    <button id="checkAnswerBtn" class="btn mt-1">ì •ë‹µ í™•ì¸</button>
                    <div id="answerResult" class="text-center p-3 bg-gray-700 rounded-lg text-gray-300">ì•„ì§ í™•ì¸ ì „ì´ì—ìš”.</div>
                    <div class="flex justify-between mt-2 gap-2">
                        <button id="prev-btn-3" class="btn btn-secondary">ì´ì „</button>
                        <button id="next-btn-3" class="btn" disabled>ìƒê°í•´ë³´ê¸°ë¡œ</button>
                    </div>
                </div>

                <div id="step-4" class="hidden"></div>

                <div id="step-5" class="hidden space-y-4 text-left">
                    <p class="text-xl text-teal-300 font-bold text-center">ğŸ§  ìƒê°í•´ë³´ê¸°</p>
                    <ul class="list-disc pl-5 space-y-2 text-gray-200">
                        <li>í”¼ìëŠ” ë‹®ì€ ì›ê¸°ë‘¥ì´ë¯€ë¡œ ë¶€í”¼ê°€ ë°˜ì§€ë¦„ì˜ ì œê³±ê³¼ ë†’ì´ì— ë¹„ë¡€í•¨ì„ ì–´ë–»ê²Œ í™œìš©í–ˆë‚˜ìš”?</li>
                        <li>ì§€ë¦„ì´ 1.5ë°°(20â†’30)ì¼ ë•Œ, ê°™ì€ ë†’ì´ë¼ë©´ ë¶€í”¼ëŠ” ëª‡ ë°°ê°€ ë˜ë‚˜ìš”?</li>
                        <li>ì´ë²ˆ ë¬¸ì œì—ì„œ Lì˜ ë†’ì´ <span class="kbd">h</span>ë¥¼ ëª¨ë¥¸ë‹¤ê³  í–ˆëŠ”ë°, ì‹¤í—˜ê³¼ ì‹ <span class="kbd">N = 9h/8</span>ì„ í†µí•´ ë¬´ì—‡ì„ ì¶”ë¡ í•  ìˆ˜ ìˆì—ˆë‚˜ìš”?</li>
                        <li>ë§Œì•½ Lì˜ ë†’ì´ê°€ Sì˜ ë†’ì´ì˜ <span class="kbd">1.5</span>ë°°ì˜€ë‹¤ë©´? í•„ìš”í•œ ê°œìˆ˜ Nì€ ì–¼ë§ˆê°€ ë ê¹Œìš”?</li>
                    </ul>
                    <div class="flex justify-between mt-2 gap-2">
                        <button id="prev-btn-5" class="btn btn-secondary">ì´ì „</button>
                        <button id="restart-btn" class="btn">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        // ìƒìˆ˜ ì •ì˜ (ì¥ë©´ ìŠ¤ì¼€ì¼)
        const L_RADIUS = 1.5;   // 30cmì— í•´ë‹¹ (ë¹„ìœ¨ í‘œí˜„ìš©)
        const L_HEIGHT = 0.3;   // ì‹¤ì œ hëŠ” UIì—ì„œëŠ” ?cmë¡œ í‘œê¸°
        const S_RADIUS = 1.0;   // 20cm
        const S_HEIGHT = 0.2;   // 2cm

        // ì‹¤ì œ ë¶€í”¼(ë‹¨ìœ„ë°°ìˆ˜) ê³„ì‚°ìš©
        const L_VOLUME = 675;   // Ï€ëŠ” ê³µí†µì´ë¼ ìƒëµ. 15^2 * 3 = 675
        const S_VOLUME = 200;   // 10^2 * 2 = 200
        const EXACT_COUNT = L_VOLUME / S_VOLUME; // 3.375

        let scene, camera, renderer, controls;
        let sPizza, lPizzaContainer, pizzaTexture;
        let filledPizza = null;
        const flyingPieces = [];
        
        let currentCount = 0;
        let targetCount = 0;
        let currentStep = 0;

        // UI Elements
        const steps = [
            document.getElementById('step-0'),
            document.getElementById('step-1'),
            document.getElementById('step-2'),
            document.getElementById('step-3'),
            document.getElementById('step-4'),
            document.getElementById('step-5')
        ];

        const sceneContainer = document.getElementById('scene-container');

        function setStep(stepIndex) {
            currentStep = stepIndex;
            steps.forEach((step, index) => {
                step.classList.toggle('hidden', index !== stepIndex);
            });
            
            // ê° ë‹¨ê³„ì— ì§„ì…í•  ë•Œ ìƒíƒœ ì´ˆê¸°í™”
            if (stepIndex === 1) {
                document.getElementById('hint-text-1').classList.add('hidden');
            }
            if (stepIndex === 2) {
                document.getElementById('hint-text-2').classList.add('hidden');
            }
            if (stepIndex === 3) {
                // Step 3 (ì •ë‹µ ì…ë ¥)ìœ¼ë¡œ ì§„ì…í•  ë•Œ ìƒíƒœ ì´ˆê¸°í™”
                document.getElementById('answerResult').textContent = 'ì•„ì§ í™•ì¸ ì „ì´ì—ìš”.';
                document.getElementById('answerResult').className = 'text-center p-3 bg-gray-700 rounded-lg text-gray-300';
                document.getElementById('answerInput').value = ''; // ì´ì „ ì…ë ¥ê°’ ì§€ìš°ê¸°
                const nextBtn3 = document.getElementById('next-btn-3');
                nextBtn3.disabled = true; // ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”
            }
        }

        function init3D() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a202c);

            camera = new THREE.PerspectiveCamera(75, sceneContainer.clientWidth / sceneContainer.clientHeight, 0.1, 1000);
            camera.position.set(0, 4.5, 5);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(sceneContainer.clientWidth, sceneContainer.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            sceneContainer.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9);
            directionalLight.position.set(5, 10, 7.5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 3;
            controls.maxDistance = 12;
            controls.target.set(0, 0, 0);

            pizzaTexture = createPizzaTexture();

            sPizza = createPizza(S_RADIUS, S_HEIGHT, pizzaTexture);
            sPizza.position.set(-3.5, S_HEIGHT / 2, 0);
            scene.add(sPizza);

            lPizzaContainer = createPizzaContainer(L_RADIUS, L_HEIGHT);
            lPizzaContainer.position.set(2, 0, 0);
            scene.add(lPizzaContainer);
            
            window.addEventListener('resize', onWindowResize);
            animate();
        }

        function createPizzaTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const context = canvas.getContext('2d');
            context.fillStyle = '#FFD700';
            context.fillRect(0, 0, 256, 256);
            context.fillStyle = '#C04040';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * 256;
                const y = Math.random() * 256;
                const radius = 10 + Math.random() * 10;
                context.beginPath();
                context.arc(x, y, radius, 0, Math.PI * 2);
                context.fill();
            }
            return new THREE.CanvasTexture(canvas);
        }

        function createPizza(radius, height, texture) {
            const group = new THREE.Group();
            const crustMaterial = new THREE.MeshStandardMaterial({ color: '#D2B48C' });
            const topMaterial = new THREE.MeshStandardMaterial({ map: texture });
            const geometry = new THREE.CylinderGeometry(radius, radius, height, 64);
            const pizzaMesh = new THREE.Mesh(geometry, [crustMaterial, topMaterial, crustMaterial]);
            pizzaMesh.castShadow = true;
            pizzaMesh.receiveShadow = true;
            group.add(pizzaMesh);
            return group;
        }

        function createPizzaPiece(size) {
            const group = new THREE.Group();
            const crustMaterial = new THREE.MeshStandardMaterial({ color: '#D2B48C' });
            const topMaterial = new THREE.MeshStandardMaterial({ map: pizzaTexture });
            const radius = S_RADIUS * size * 0.3;
            const height = S_HEIGHT * 0.5;
            const geometry = new THREE.CylinderGeometry(radius, radius, height, 32);
            const pizzaMesh = new THREE.Mesh(geometry, [crustMaterial, topMaterial, crustMaterial]);
            pizzaMesh.castShadow = true;
            group.add(pizzaMesh);
            return group;
        }
        
        function createPizzaContainer(radius, height) {
            const group = new THREE.Group();
            
            const lineMaterial = new THREE.MeshStandardMaterial({ 
                color: '#999999', 
                side: THREE.DoubleSide, 
                transparent: true, 
                opacity: 0.15,
                wireframe: false
            });
            
            const bottomGeo = new THREE.CylinderGeometry(radius, radius, 0.02, 64);
            const bottom = new THREE.Mesh(bottomGeo, lineMaterial);
            bottom.position.y = -height / 2;
            bottom.receiveShadow = true;
            
            const wallGeo = new THREE.CylinderGeometry(radius, radius, height, 64, 1, true);
            const wall = new THREE.Mesh(wallGeo, lineMaterial);
            
            const ghostMaterial = new THREE.MeshStandardMaterial({ 
                color: '#FFE4B5',
                transparent: true, 
                opacity: 0.5,
                side: THREE.DoubleSide
            });
            const ghostPizzaGeo = new THREE.CylinderGeometry(radius * 0.98, radius * 0.98, height, 64);
            const ghostPizza = new THREE.Mesh(ghostPizzaGeo, ghostMaterial);
            ghostPizza.receiveShadow = true;
            
            group.add(bottom);
            group.add(wall);
            group.add(ghostPizza);
            
            return group;
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            for (let i = flyingPieces.length - 1; i >= 0; i--) {
                const piece = flyingPieces[i];
                piece.progress += 0.03;
                
                const arcHeight = Math.sin(piece.progress * Math.PI) * 2.5;
                piece.mesh.position.lerpVectors(piece.start, piece.end, piece.progress);
                piece.mesh.position.y += arcHeight;
                
                piece.mesh.rotation.x += 0.1;
                piece.mesh.rotation.y += 0.15;
                
                if (piece.progress >= 1) {
                    scene.remove(piece.mesh);
                    flyingPieces.splice(i, 1);
                    
                    if (flyingPieces.length === 0) {
                        updateFilledPizza(targetCount);
                    }
                }
            }
            
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = sceneContainer.clientWidth / sceneContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(sceneContainer.clientWidth, sceneContainer.clientHeight);
        }

        function updateVisualization() {
            const inputEl = document.getElementById('pizzaCountInput');
            let count = parseFloat(inputEl.value);
            
            if (isNaN(count) || count < 0) count = 0;
            const maxPizzas = 10;
            if (count > maxPizzas) {
                count = maxPizzas;
                inputEl.value = maxPizzas;
            }
            
            targetCount = count;
            
            if (count > currentCount) {
                const diff = count - currentCount;
                createFlyingPieces(diff);
            } else {
                updateFilledPizza(count);
            }
            
            currentCount = count;
            updateStatusText(count);
        }

        function createFlyingPieces(pizzaCount) {
            const numPieces = Math.max(8, Math.ceil(pizzaCount * 8));
            
            for (let i = 0; i < numPieces; i++) {
                const piece = createPizzaPiece(0.5 + Math.random() * 0.5);
                
                const startAngle = (i / numPieces) * Math.PI * 2;
                const startRadius = 0.3;
                const startX = sPizza.position.x + Math.cos(startAngle) * startRadius;
                const startY = sPizza.position.y + (Math.random() - 0.5) * 0.5;
                const startZ = sPizza.position.z + Math.sin(startAngle) * startRadius;
                
                piece.position.set(startX, startY, startZ);
                scene.add(piece);
                
                const endAngle = Math.random() * Math.PI * 2;
                const endRadius = L_RADIUS * Math.random() * 0.8;
                const endX = lPizzaContainer.position.x + Math.cos(endAngle) * endRadius;
                const endZ = lPizzaContainer.position.z + Math.sin(endAngle) * endRadius;
                
                const fillHeight = calculateFillHeight(targetCount);
                const endY = lPizzaContainer.position.y - (L_HEIGHT / 2) + fillHeight;
                
                flyingPieces.push({
                    mesh: piece,
                    start: new THREE.Vector3(startX, startY, startZ),
                    end: new THREE.Vector3(endX, endY, endZ),
                    progress: 0
                });
            }
        }

        function calculateFillHeight(pizzaCount) {
            const heightInCm = (pizzaCount * 200) / 225; // hë¥¼ ëª¨ë¥¸ë‹¤ê³  í‘œê¸°í–ˆì–´ë„ ë‚´ë¶€ ê³„ì‚°ì€ h=3ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜
            const fillHeight = heightInCm * 0.1;
            return fillHeight;
        }

        function updateFilledPizza(pizzaCount) {
            if (filledPizza) {
                lPizzaContainer.remove(filledPizza);
            }
            
            if (pizzaCount === 0) return;
            
            const fillHeight = calculateFillHeight(pizzaCount);
            
            const crustMaterial = new THREE.MeshStandardMaterial({ color: '#D2B48C' });
            const topMaterial = new THREE.MeshStandardMaterial({ map: pizzaTexture });
            const geometry = new THREE.CylinderGeometry(L_RADIUS * 0.98, L_RADIUS * 0.98, fillHeight, 64);
            const pizzaMesh = new THREE.Mesh(geometry, [crustMaterial, topMaterial, crustMaterial]);
            pizzaMesh.castShadow = true;
            pizzaMesh.receiveShadow = true;
            
            filledPizza = new THREE.Group();
            filledPizza.add(pizzaMesh);
            
            filledPizza.position.y = -(L_HEIGHT / 2) + (fillHeight / 2);
            
            lPizzaContainer.add(filledPizza);
        }
        
        function updateStatusText(count) {
            const totalSVolume = count * S_VOLUME;
            const percentage = (totalSVolume / L_VOLUME) * 100;
            const statusEl = document.getElementById('status');
            const nextBtn1 = document.getElementById('next-btn-1');
            const jumpToAnswerBtn = document.getElementById('jump-to-answer-btn');
            
            if (count === 0) {
                statusEl.className = 'text-center p-4 bg-gray-700 rounded-lg mt-2 text-gray-300';
                statusEl.textContent = 'ìˆ«ìë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”!';
                nextBtn1.classList.remove('hidden');
                jumpToAnswerBtn.classList.add('hidden');
            } else if (percentage < 95) {
                statusEl.className = 'text-center p-4 bg-yellow-900 rounded-lg mt-2 text-yellow-200';
                statusEl.textContent = `ğŸ• ${count.toFixed(1)}ê°œ íˆ¬ì…! ì•„ì§ ê³µê°„ì´ ë‚¨ì•˜ì–´ìš”!`;
                nextBtn1.classList.remove('hidden');
                jumpToAnswerBtn.classList.add('hidden');
            } else if (percentage >= 95 && percentage <= 105) {
                statusEl.className = 'text-center p-4 bg-teal-900 rounded-lg mt-2 text-teal-200 font-bold';
                statusEl.textContent = `ğŸ‰ ${count.toFixed(1)}ê°œë¡œ ê±°ì˜ ë”± ë§ì•„ìš”!`;
                nextBtn1.classList.add('hidden');
                jumpToAnswerBtn.classList.remove('hidden');
            } else {
                statusEl.className = 'text-center p-4 bg-red-900 rounded-lg mt-2 text-red-200';
                statusEl.textContent = `ğŸ’¥ ${count.toFixed(1)}ê°œëŠ” ë„ˆë¬´ ë§ì•„ìš”! ë„˜ì³¤ì–´ìš”!`;
                nextBtn1.classList.remove('hidden');
                jumpToAnswerBtn.classList.add('hidden');
            }
        }

        function checkAnswer() {
            const ansInput = document.getElementById('answerInput').value.trim().replace(',', '.');
            const val = parseFloat(ansInput);
            const box = document.getElementById('answerResult');
            const nextBtn = document.getElementById('next-btn-3');

            if (isNaN(val)) {
                box.className = 'text-center p-3 bg-red-900 rounded-lg text-red-100';
                box.textContent = 'ìˆ«ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
                nextBtn.disabled = true;
                return;
            }
            const diff = Math.abs(val - EXACT_COUNT);
            if (diff <= 0.01) {
                box.className = 'text-center p-3 bg-teal-900 rounded-lg text-teal-100 font-bold';
                box.innerHTML = `ì •ë‹µì…ë‹ˆë‹¤ğŸ˜Š`;
                nextBtn.disabled = false; // ì •ë‹µì¼ ê²½ìš° ë²„íŠ¼ í™œì„±í™”
            } else {
                const hint = (val < EXACT_COUNT) ? 'ì¡°ê¸ˆ ë” í¬ê²Œ' : 'ì¡°ê¸ˆ ë” ì‘ê²Œ';
                box.className = 'text-center p-3 bg-yellow-900 rounded-lg text-yellow-100';
                box.innerHTML = `ì•„ì‰½ë„¤ìš”. â— ${hint} ì…ë ¥í•´ ë³´ì„¸ìš”. (ì˜¤ì°¨: ${diff.toFixed(3)})`;
                nextBtn.disabled = true; // ì˜¤ë‹µì¼ ê²½ìš° ë²„íŠ¼ ë¹„í™œì„±í™”
            }
        }

        // Event Listeners
        document.getElementById('next-btn-0').addEventListener('click', () => setStep(1));

        document.getElementById('hint-btn-1').addEventListener('click', () => {
            document.getElementById('hint-text-1').classList.remove('hidden');
        });
        document.getElementById('next-btn-1').addEventListener('click', () => setStep(2));
        document.getElementById('prev-btn-1').addEventListener('click', () => setStep(0));

        // âœ¨ ì¶”ê°€ëœ ë²„íŠ¼ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('jump-to-answer-btn').addEventListener('click', () => setStep(3));

        document.getElementById('hint-btn-2').addEventListener('click', () => {
            document.getElementById('hint-text-2').classList.remove('hidden');
        });
        document.getElementById('next-btn-2').addEventListener('click', () => setStep(3));
        document.getElementById('prev-btn-2').addEventListener('click', () => setStep(1));

        document.getElementById('checkAnswerBtn').addEventListener('click', checkAnswer);
        document.getElementById('next-btn-3').addEventListener('click', () => setStep(5));
        document.getElementById('prev-btn-3').addEventListener('click', () => setStep(2));

        document.getElementById('prev-btn-5').addEventListener('click', () => setStep(3));
        document.getElementById('restart-btn').addEventListener('click', () => {
            currentCount = 0;
            targetCount = 0;
            const input = document.getElementById('pizzaCountInput');
            if (input) input.value = 0;
            if (filledPizza) {
                lPizzaContainer.remove(filledPizza);
                filledPizza = null;
            }
            setStep(0);
        });

        // ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ì…ë ¥
        document.getElementById('pizzaCountInput').addEventListener('input', updateVisualization);
        
        // ì´ˆê¸°í™”
        init3D();
        setStep(0);
    </script>
</body>
</html>
